{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import * as cg from \"./tscodegen\";\nimport ApiGenerator from \"./generate\";\nimport ts from \"typescript\";\nimport SwaggerParser from \"@apidevtools/swagger-parser\";\nimport converter from \"swagger2openapi\";\nimport { OpenAPI, OpenAPIV3 } from \"openapi-types\";\n\nexport { cg };\n\nexport const optsArgumentStyles = [\"positional\", \"object\"];\nexport type Opts = {\n  include?: string[];\n  exclude?: string[];\n  optimistic?: boolean;\n  unionUndefined?: boolean;\n  useEnumType?: boolean;\n  mergeReadWriteOnly?: boolean;\n  useUnknown?: boolean;\n  argumentStyle?: (typeof optsArgumentStyles)[number];\n};\n\nexport function generateAst(\n  doc: OpenAPIV3.Document,\n  opts: Opts,\n  isConverted: boolean,\n) {\n  return new ApiGenerator(doc, opts, isConverted).generateApi();\n}\n\nexport function printAst(ast: ts.SourceFile) {\n  return cg.printFile(ast);\n}\n\nexport async function generateSource(\n  spec: string,\n  opts: Opts = {},\n): Promise<string> {\n  const { doc, isConverted } = await parseSpec(spec);\n  const ast = generateAst(doc, opts, isConverted);\n  const { title, version } = doc.info;\n  const preamble = [\"$&\", title, version].filter(Boolean).join(\"\\n * \");\n  const src = printAst(ast);\n  return src.replace(/^\\/\\*\\*/, preamble);\n}\n\nfunction isOpenApiV3(doc: OpenAPI.Document): doc is OpenAPIV3.Document {\n  return \"openapi\" in doc && doc.openapi.startsWith(\"3\");\n}\n\nexport async function parseSpec(spec: string) {\n  const doc = await SwaggerParser.bundle(spec);\n  if (isOpenApiV3(doc)) {\n    return {\n      doc,\n      isConverted: false,\n    };\n  } else {\n    const converted = await converter.convertObj(doc, {});\n    return {\n      doc: converted.openapi as OpenAPIV3.Document,\n      isConverted: true,\n    };\n  }\n}\n"],"names":["optsArgumentStyles","generateAst","doc","opts","isConverted","ApiGenerator","printAst","ast","cg.printFile","generateSource","spec","parseSpec","title","version","preamble","isOpenApiV3","SwaggerParser","converter"],"mappings":";;;;AASO,MAAMA,IAAqB,CAAC,cAAc,QAAQ;AAYlD,SAASC,EACdC,GACAC,GACAC,GACA;AACA,SAAO,IAAIC,EAAaH,GAAKC,GAAMC,CAAW,EAAE,YAAA;AAClD;AAEO,SAASE,EAASC,GAAoB;AAC3C,SAAOC,EAAaD,CAAG;AACzB;AAEA,eAAsBE,EACpBC,GACAP,IAAa,IACI;AACjB,QAAM,EAAE,KAAAD,GAAK,aAAAE,EAAA,IAAgB,MAAMO,EAAUD,CAAI,GAC3CH,IAAMN,EAAYC,GAAKC,GAAMC,CAAW,GACxC,EAAE,OAAAQ,GAAO,SAAAC,EAAA,IAAYX,EAAI,MACzBY,IAAW,CAAC,MAAMF,GAAOC,CAAO,EAAE,OAAO,OAAO,EAAE,KAAK;AAAA,IAAO;AAEpE,SADYP,EAASC,CAAG,EACb,QAAQ,WAAWO,CAAQ;AACxC;AAEA,SAASC,EAAYb,GAAkD;AACrE,SAAO,aAAaA,KAAOA,EAAI,QAAQ,WAAW,GAAG;AACvD;AAEA,eAAsBS,EAAUD,GAAc;AAC5C,QAAMR,IAAM,MAAMc,EAAc,OAAON,CAAI;AAC3C,SAAIK,EAAYb,CAAG,IACV;AAAA,IACL,KAAAA;AAAA,IACA,aAAa;AAAA,EAAA,IAIR;AAAA,IACL,MAFgB,MAAMe,EAAU,WAAWf,GAAK,CAAA,CAAE,GAEnC;AAAA,IACf,aAAa;AAAA,EAAA;AAGnB;"}