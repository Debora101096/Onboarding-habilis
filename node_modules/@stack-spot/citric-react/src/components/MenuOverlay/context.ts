import { createContext, useContext, useEffect, useState } from 'react'
import { ValueController } from '../../utils/ValueController'
import { MenuState } from './types'

const context = createContext<ValueController<MenuState> | undefined>(undefined)

export const MenuProvider = context.Provider

export function useMenuController() {
  return useContext(context)
}

export function useMenuState(controller?: ValueController<MenuState>) {
  const controllerFromContext = useMenuController()
  controller ??= controllerFromContext
  if (!controller) throw new Error('useMenuState used outside the context of a Menu')
  const [state, setState] = useState(controller.getValue())
  useEffect(() => controller.onChange(setState))
  return state
}
