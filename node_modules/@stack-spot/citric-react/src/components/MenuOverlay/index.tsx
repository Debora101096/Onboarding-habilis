import { Dictionary, useTranslate } from '@stack-spot/portal-translate'
import { useMemo } from 'react'
import { IconButton } from '../IconBox'
import { Overlay } from '../Overlay'
import { Menu } from './Menu'
import { MenuOverlayProps } from './types'

/**
 * Creates a menu overlay for its child element. Whenever the child element is clicked, the menu appears. Closing the menu is also handled
 * by this component.
 * 
 * The menu is defined by the property "items" and can contain sections and sub menus.
 * 
 * If no child is provided, a button with the vertical ellipsis icon is rendered.
 * 
 * @example
 * 
 * ```
 * const items: MenuItem[] = useMemo([
 *   { label: 'View', href: `/resource/${id}` },
 *   { label: 'Edit', onClick: () => editResource(id) },
 *   { label: 'Remove', onClick: () => removeResource(id), style: { color: theme.color.danger[500] } },
 * ], [id])
 * 
 * return <MenuOverlay items={items}><IconButton icon="Plus" /></MenuOverlay>
 * ```
 */
export const MenuOverlay = ({
  id, items, appearance, bgLevel, header, roundedItems, showBorders, showShadows, spaced, menuClass, menuStyle, children, ...props
}: MenuOverlayProps) => {
  const t = useTranslate(dictionary)
  const randomId = useMemo(() => `${Math.random()}`, [])
  const menuProps = {
    items, appearance, bgLevel, roundedItems, showBorders, showShadows, spaced, header, className: menuClass, style: menuStyle,
  }
  return (
    <Overlay
      content={<Menu {...menuProps} />}
      attributes={{ id: id || randomId, style: { margin: '8px' } }}
      triggerOn="click"
      {...props}
    >
      {children ?? <IconButton icon="EllipsisVertical" aria-label={t.open} />}
    </Overlay>
  )
}

const dictionary = {
  en: {
    open: 'Open menu',
  },
  pt: {
    open: 'Abrir menu',
  },
} satisfies Dictionary
