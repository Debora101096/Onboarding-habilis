import { Suspense } from 'react'
import { ErrorBoundary } from './ErrorBoundary'
import { Center } from './layout'
import { ProgressCircular } from './ProgressCircular'

interface Props {
  /**
   * Replaces the error message with this text.
   */
  message?: string,
  children: React.ReactNode,
}

const loading = (
  <Center flex={1} p="80px" data-test-hint="loading">
    <ProgressCircular />
  </Center>
)

/**
 * A Boundary that renders an error feedback if a child throws an error or a loading feedback if it suspends.
 * 
 * You can customize the appearance of the loading and error views through a CitricController.
 * 
 * Errors can be watched through the function `onError` of a CitricController.
 * 
 * @example
 * ```
 * <FallbackBoundary>
 *   {content}
 * </FallbackBoundary>
 * ```
 */
export const FallbackBoundary = ({ children, message }: Props) => (
  <ErrorBoundary message={message}>
    <Suspense fallback={loading}>
      {children}
    </Suspense>
  </ErrorBoundary>
)
