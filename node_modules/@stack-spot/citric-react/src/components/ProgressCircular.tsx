import { listToClass } from '@stack-spot/portal-theme'
import { isNil } from 'lodash'
import { WithColorPalette, WithColorScheme } from '../types'
import { applyCSSVariable } from '../utils/css'
import { withRef } from '../utils/react'
import { CitricComponent } from './CitricComponent'

export interface BaseProgressCircularProps extends WithColorScheme, WithColorPalette {
  /**
   * A number varying from 0 to 100.
   * 
   * If not provided, the progress will be indeterminate, causing an animation loop.
   */
  progress?: number,
  /**
   * @default 'md'
   */
  size?: 'xs' | 'sm' | 'md' | 'lg',
}

export type ProgressCircularProps = React.JSX.IntrinsicElements['div'] & BaseProgressCircularProps

/**
 * Shows a circular progress. This can indicate a loading state (spinner) or the progress of a task. When "progress" is not set, the
 * spinner is animated, indicating a busy state.
 * 
 * @example
 * A simple loading with a Progress Circular.
 * ```
 * <ProgressCircular />
 * ```
 * A Progress Circular that is 50% complete.
 * ```
 * <ProgressCircular progress={50} />
 * ```
 */
export const ProgressCircular = withRef(({ progress, size, style, className, ...props }: ProgressCircularProps) =>
  <CitricComponent
    tag="div"
    component="progress-circular"
    className={listToClass([size, className, isNil(progress) && 'indeterminate'])}
    style={progress === undefined ? style : applyCSSVariable(style, 'progress', progress)}
    {...props}
  />,
)
