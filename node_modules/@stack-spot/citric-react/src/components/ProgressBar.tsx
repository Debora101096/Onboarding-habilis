import { listToClass } from '@stack-spot/portal-theme'
import { isNil } from 'lodash'
import { WithColorPalette, WithColorScheme } from '../types'
import { applyCSSVariable } from '../utils/css'
import { withRef } from '../utils/react'
import { CitricComponent } from './CitricComponent'

export interface BaseProgressBarProps extends WithColorScheme, WithColorPalette {
  /**
   * A number varying from 0 to 100.
   * 
   * If not provided, the progress will be indeterminate, causing an animation loop.
   */
  progress?: number,
  /**
   * The speed which the bar animation runs. Only valid if `progress` is `undefined`.
   */
  speed?: 'normal' | 'fast',
}

export type ProgressBarProps = React.JSX.IntrinsicElements['div'] & BaseProgressBarProps

/**
 * Shows a progress bar. This can indicate a loading state or the progress of a task. When "progress" is not set, the bar is animated,
 * indicating a busy state.
 * 
 * @example
 * A simple loading with a Progress Bar.
 * ```
 * <ProgressBar />
 * ```
 * A Progress Bar that is 50% complete.
 * ```
 * <ProgressBar progress={50} />
 * ```
 */
export const ProgressBar = withRef(({ progress, speed, style, className, ...props }: ProgressBarProps) =>
  <CitricComponent
    tag="div"
    component="progress-bar"
    className={listToClass([className, isNil(progress) && 'indeterminate', speed === 'fast' && 'fast'])}
    style={progress === undefined ? style : applyCSSVariable(style, 'progress', progress)}
    {...props}
  />,
)
