import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { listToClass } from '@stack-spot/portal-theme';
import { Children, useMemo, useState } from 'react';
import { useCitricController } from '../context/hooks.js';
import { withRef } from '../utils/react.js';
import { CitricComponent } from './CitricComponent.js';
import { ProgressCircular } from './ProgressCircular.js';
/**
 * Renders a button. The type is "button" by default.
 *
 * Whenever a button is clicked, the function `onClickButton` of the nearest CitricController is called with the event and the value of the
 * prop `metadata`.
 *
 * @example
 * ```
 * <Button>My Button</Button>
 * ```
 */
export const Button = withRef(({ appearance, size, feedback, loading, disabled, onClick, className, children, type = 'button', metadata, ...props }) => {
    const citric = useCitricController();
    const [waiting, setWaiting] = useState(false);
    const busy = loading || waiting;
    const isAllLowercase = useMemo(() => !Children.toArray(children).some(c => typeof c === 'string' && c.toLocaleLowerCase() !== c), [children]);
    async function handleClick(e) {
        const result = onClick?.(e);
        citric?.onClickButton?.(e, metadata);
        if (result instanceof Promise) {
            setWaiting(true);
            try {
                await result;
            }
            catch { /* empty */ }
            setWaiting(false);
        }
    }
    return (_jsxs(CitricComponent, { tag: "button", component: "button", className: listToClass([size, appearance, isAllLowercase && 'short-text', className]), "data-feedback": feedback || undefined, onClick: handleClick, "aria-busy": busy, disabled: disabled || busy, type: type, ...props, children: [busy ? _jsx("div", { children: children }) : children, busy && (_jsx("div", { className: "loader", children: _jsx(ProgressCircular, { size: "sm" }) }))] }));
});
//# sourceMappingURL=Button.js.map