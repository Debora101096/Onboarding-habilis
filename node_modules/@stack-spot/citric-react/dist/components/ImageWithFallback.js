import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from "react/jsx-runtime";
import { listToClass } from '@stack-spot/portal-theme';
import { useEffect, useMemo, useState } from 'react';
import { getStyleFromProps } from '../utils/css.js';
import { Skeleton } from './Skeleton.js';
/**
 * Attempts to render an image. If it succeeds, the image is displayed, otherwise, a fallback is rendered.
 *
 * This is very useful if the value of "src" may be empty or if it may be broken. Instead of rendering nothing or the default browser error,
 * it renders the fallback passed as parameter.
 *
 * @example
 * ```
 * <ImageWithFallback src={item.image} fallback={<Icon icon="Agent" />} />
 * ```
 */
export const ImageWithFallback = ({ onLoad, onError, className, style: ogStyle, fallback, showLoading, w, h, radius, bg, ...props }) => {
    const [state, setState] = useState(props.src ? 'loading' : 'error');
    const isLoading = state === 'loading' && showLoading;
    const style = useMemo(() => ({ ...getStyleFromProps({ w, h, radius, bg }), ...ogStyle }), [ogStyle, w, h, radius, bg]);
    function handleLoad(e) {
        if (state === 'loading')
            setState('ready');
        onLoad?.(e);
    }
    function handleError(e) {
        setState('error');
        onError?.(e);
    }
    useEffect(() => {
        if (state !== 'loading')
            setState(props.src ? 'loading' : 'error');
    }, [props.src]);
    if (state === 'error')
        return _jsx("div", { className: listToClass([className, 'center']), style: style, children: fallback });
    return _jsxs(_Fragment, { children: [isLoading && _jsx(Skeleton, { className: className, style: style }), _jsx("img", { onLoad: handleLoad, onError: handleError, style: { ...style, ...(isLoading ? { pointerEvents: 'none', position: 'absolute', opacity: 0 } : {}) }, "aria-hidden": isLoading, className: className, ...props })] });
};
//# sourceMappingURL=ImageWithFallback.js.map