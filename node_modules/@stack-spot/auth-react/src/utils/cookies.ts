import { ThirdPartyLoginParams } from '@stack-spot/auth'
import { getCookie, getCookieDomain, removeCookie, setCookie } from '@stack-spot/portal-components'

const sessionKey = `stk-session${getCookieDomain()}`

type SessionCookie = ThirdPartyLoginParams & { sub: string, tenant: string }

export const sessionCookie = Object.freeze({
  /**
   * Sets the user's session cookie
   * @param data session to be saved in the cookie
   * @param customAttributes Accepted values: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#attributes.
   */
  set: (data: SessionCookie, customAttributes: Record<string, any> = {}) => setCookie(sessionKey, JSON.stringify(data), customAttributes),
  get: (): SessionCookie | undefined => {
    try {
      const cookie = getCookie(sessionKey)
      return cookie ? JSON.parse(cookie) : undefined
    } catch (error) {
      console.error(error)
    }
  },
  delete: () => removeCookie(sessionKey)
})
