import { getCookie } from '@stack-spot/portal-components'
import { LoginType } from './types'

const lastLoginTypeKey = 'lastLoginType'
const fallbackKeys = ['guided-tour', '@stack-spot/opa:user', 'CHAT_AGENTS', 'RATED_US_IN']

export function getLastLoginType(): LoginType {
  const type = localStorage.getItem(lastLoginTypeKey)
  if (type === 'idp' || type === 'sso') return type
  // for now, the user won't have the variable "lastLoginType" set. So, we check for tother variables that may indicate this is an enterprise user
  if (getCookie('stk-session.stackspot.com')) return 'sso'
  for (const key of fallbackKeys) {
    if (localStorage.getItem(key)) return 'sso'
  }
  return 'idp'
}

export function setLastLoginType(type: LoginType) {
  localStorage.setItem(lastLoginTypeKey, type)
}
