import { lstat, readdir, readFile } from 'fs/promises'
import { firstCharacter, maps, source } from './constants'

export function capitalize(str: string) {
  return `${str[0].toUpperCase()}${str.substring(1)}`
}

export async function getIconsInGroup(name: string) {
  const allFiles = await readdir(`${source}/${name}`)
  return allFiles.filter(f => f.endsWith('.svg'))
}

export async function getIconGroups(): Promise<string[]> {
  const files = await readdir(source)
  const stats = await Promise.all(files.map(f => lstat(`${source}/${f}`)))
  return files.filter((_, i) => stats[i].isDirectory())
}

export async function getIconMap(name: string): Promise<{ lastUnicode: number, mappings: Record<string, number> }> {
  try {
    const content = await readFile(`${maps}/${name}.json`, { encoding: 'utf-8' })
    const mappings: Record<string, number> = JSON.parse(content)
    const max = Object.values(mappings).reduce((result, current) => current > result ? current : result, firstCharacter)
    return { lastUnicode: max, mappings }
  } catch {
    return { lastUnicode: firstCharacter - 1, mappings: {} }
  }
}
