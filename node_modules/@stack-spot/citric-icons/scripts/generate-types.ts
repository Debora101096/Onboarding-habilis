/* eslint-disable no-console */
import { mkdir, writeFile } from 'fs/promises'
import { types as typesDir } from './constants'
import { capitalize, getIconGroups, getIconsInGroup } from './utils'

function generateTypes(name: string, icons: string[]) {
  const types = [`export type CitricIcon${capitalize(name)} = (`]
  for (const icon of icons) {
    types.push(`  | '${icon.replace(/\.svg$/, '')}'`)
  }
  types.push(')\n')
  return writeFile(`${typesDir}/${name}.ts`, types.join('\n'), { encoding: 'utf8' })
}

async function start() {
  const groups = await getIconGroups()
  let hasError = false
  await mkdir(typesDir, { recursive: true })
  await Promise.all(groups.map(async (group) => {
    try {
      const files = await getIconsInGroup(group)
      await generateTypes(group, files)
      console.log('Types successfully generated for', group)
    } catch (error) {
      hasError = true
      console.error('Error while generating types for ${group}. Check the errors below for more details.')
      console.error(error)
    }
  }))
  process.exit(hasError ? 1 : 0)
}

start()
