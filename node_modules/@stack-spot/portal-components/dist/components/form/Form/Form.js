import { jsx as _jsx } from "react/jsx-runtime";
import { get } from 'lodash';
import { FormProvider, useForm, useFormContext } from 'react-hook-form';
function handleGraphqlErrors(error, methods) {
    const errors = get(error, 'cause.extensions.fields');
    if (errors) {
        Object.keys(errors).forEach((key) => {
            if (Object.keys(methods.control._fields).includes(key)) {
                methods.setError(key, { type: 'server', message: errors[`${key}`] });
            }
        });
    }
}
const handleFormSubmit = async (data, methods, onSubmit) => {
    if (!onSubmit) {
        return;
    }
    const result = methods.handleSubmit(onSubmit)(data);
    const isPromise = result instanceof Promise;
    if (!isPromise) {
        return result;
    }
    try {
        return await result;
    }
    catch (error) {
        const isGraphqlError = error.message === 'GraphqlError';
        if (!isGraphqlError) {
            throw error;
        }
        handleGraphqlErrors(error, methods);
    }
};
const BasicForm = ({ onSubmit, id, name, children, methods, autoComplete, ...props }) => (_jsx("form", { id: id, autoComplete: autoComplete, name: name, onSubmit: (data) => handleFormSubmit(data, methods, onSubmit), noValidate: true, style: props.style, className: props.className, children: children }));
const FormWithProvider = (props) => {
    const methods = useForm({ defaultValues: props.defaultValues });
    const form = props.form || methods;
    return (_jsx(FormProvider, { ...form, children: _jsx(BasicForm, { ...props, methods: form }) }));
};
export const Form = (props) => {
    const useFormMethods = useFormContext();
    const hasFormProvider = !!useFormMethods;
    if (hasFormProvider) {
        return _jsx(BasicForm, { ...props, methods: useFormMethods });
    }
    return _jsx(FormWithProvider, { ...props });
};
//# sourceMappingURL=Form.js.map