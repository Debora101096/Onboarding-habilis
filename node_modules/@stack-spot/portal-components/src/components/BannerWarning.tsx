
import { Button, Flex, IconBox, SxProp, Text } from '@citric/core'
import { ExclamationTriangle, TimesCircleFill } from '@citric/icons'
import { Alert } from '@citric/ui'
import { useState } from 'react'
import { getCookie, setCookie } from '../utils/cookie'

/**
 * A styled and dismissible alert box for showing important warnings for the user.
 *
 * This renders a yellow box with an exclamation icon. The content passed as parameter is placed on the right of the icon.
 * @param props an object containing the content (children) to show inside the alert box.
 */
export const BannerWarning = ({ children, showCloseButton = true }:
  { children: React.ReactNode, sx?: SxProp, showCloseButton?: boolean }) => {
  const bannerKey = 'bannerClosed'

  const [isVisible, setIsVisible] = useState(() => {
    if (typeof window !== 'undefined') {
      const isBannerClosed = getCookie(bannerKey) === 'true'
      return !isBannerClosed
    }
    return false
  })

  const handleClose = () => {
    setCookie(bannerKey, 'true')
    setIsVisible(false)
  }

  if (!isVisible) {
    return null
  }

  return (
    <Flex sx={{ zIndex: '1', w: '12', mb: 7 }}>
      <Alert
        colorScheme="warning"
        sx={{
          position: 'relative',
          px: 3,
          py: 1,
          alignItems: 'center',
          display: 'flex',
          justifyContent: 'space-between',
          height: 'auto',
          padding: `${showCloseButton ? '0.5rem' : '1rem'}`,
        }}
      >
        <Flex
          sx={{
            alignItems: 'center',
            flexWrap: 'nowrap',
          }}
        >
          <IconBox
            size="sm"
            colorIcon="light.500"
          >
            <ExclamationTriangle />
          </IconBox>
          <Text
            sx={{
              ml: 5,
            }}
            appearance="body2"
            colorScheme="warning.contrastText"
          >
            {children}
          </Text>
        </Flex>

        {showCloseButton && <Button
          appearance={'text'}
          onClick={handleClose}
          sx={{
            p: 0,
            ml: 2,
          }}
        >
          <IconBox
            size="lg"
            colorIcon="light.500"
          >
            <TimesCircleFill />
          </IconBox>
        </Button>}
      </Alert>
    </Flex>
  )
}
