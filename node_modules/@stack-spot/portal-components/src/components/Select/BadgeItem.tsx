import { SxProperties } from '@citric/core/dist/sx'
import { TimesMini } from '@citric/icons'
import { Badge, IconButton } from '@citric/ui'
import { Dictionary, interpolate, useTranslate } from '@stack-spot/portal-translate'
import { MouseEvent } from 'react'
import { components, GroupBase, MultiValueProps } from 'react-select'
import { CreatableSelectOptionType } from './types'

export const BadgeItem = (props: MultiValueProps<CreatableSelectOptionType, boolean, GroupBase<any>>) => {
  const t = useTranslate(dictionary)

  const handleClick = <T extends HTMLElement>(event: MouseEvent<T>) => {
    props.removeProps.onClick?.(event as unknown as MouseEvent<HTMLDivElement>)
  }

  return (
    <components.MultiValue {...props}>
      <Badge
        appearance="square"
        className="badge"
        palette="cyan"
        sx={{ mb: 2, 
          '.badge-citric-container:not(:has(> button:first-child))': {
            marginRight: 0,
          },
        } as SxProperties}
        afterElement={
          <components.MultiValueRemove {...props}>
            <IconButton
              type="button"
              aria-label={interpolate(t.ariaLabelRemoveItemButton, props.children)}
              colorIcon="cyan.800"
              appearance="square"
              onClick={(e) => {
                e.stopPropagation()
                handleClick(e)
              }}
            >
              <TimesMini />
            </IconButton>
          </components.MultiValueRemove>
        }
      >
        {props.children}
      </Badge>
    </components.MultiValue>
  )
}

const dictionary = {
  en: {
    ariaLabelRemoveItemButton: 'Remove item $0',
  },
  pt: {
    ariaLabelRemoveItemButton: 'Remover item $0',
  },
} satisfies Dictionary

