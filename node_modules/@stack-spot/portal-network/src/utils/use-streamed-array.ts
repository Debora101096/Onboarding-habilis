import { useEffect, useState } from 'react'
import { StreamingStatus } from '../types'
import { StreamedArray } from './StreamedArray'

export function useStreamedArray<T>(stream: StreamedArray<T> | undefined) {
  const [array, setArray] = useState<T[]>(stream?.getPartialValue() ?? [])
  const [status, setStatus] = useState<StreamingStatus>(stream?.getStatus() ?? 'pending')
  useEffect(() => {
    setArray(stream?.getPartialValue() ?? [])
    setStatus(stream?.getStatus() ?? 'pending')
    return stream?.onChange((values) => {
      setArray(values)
      setStatus(stream.getStatus())
    })
  }, [stream])
  return [array, status]
}
