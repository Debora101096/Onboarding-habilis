import { HttpError } from '@oazapfts/runtime'
import { commit, committedNotifications, defaults, findAll } from '../api/notification'
import { DefaultAPIError } from '../error/DefaultAPIError'
import { baseDictionary } from '../error/dictionary/base'
import { StackspotAPIError } from '../error/StackspotAPIError'
import { ReactQueryNetworkClient } from '../network/ReactQueryNetworkClient'
import { getApiAddresses } from '../api-addresses'

class NotificationClient extends ReactQueryNetworkClient {

  constructor() {
    super(getApiAddresses().notification.url, defaults)
  } 

  protected buildStackSpotError(error: HttpError): StackspotAPIError {
    return new DefaultAPIError(error.data, error.status, baseDictionary, error.headers)
  }
  /**
   * Gets all notification by tenant
   */
  notifications = this.query(findAll)
  /**
   * Gets all committed notifications by tenant
   */
  committedNotifications = this.query(committedNotifications)
  /**
   * Mark a notification as committed (mark as read)
   */
  commit = this.mutation(commit)
}

export const notificationClient = new NotificationClient()
