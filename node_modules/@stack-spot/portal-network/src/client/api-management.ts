import { HttpError } from '@oazapfts/runtime'
import { getApiAddresses } from '../api-addresses'
import { defaults, downloadObjectArtifacts, getEntries, getEntryById, getSubEntries } from '../api/apiManagement'
import { DefaultAPIError } from '../error/DefaultAPIError'
import { actionDictionary } from '../error/dictionary/action'
import { StackspotAPIError } from '../error/StackspotAPIError'
import { ReactQueryNetworkClient } from '../network/ReactQueryNetworkClient'

class ApiManagementClient extends ReactQueryNetworkClient {
  constructor() {
    super(getApiAddresses().apiManagement.url, defaults)
  } 

  protected buildStackSpotError(error: HttpError): StackspotAPIError {
    return new DefaultAPIError(error.data, error.status, actionDictionary, error.headers)
  }

  /**
   * Get list
   */
  getList = this.query(getEntries)
  
  /**
   * Get api by id
   */
  getApiById = this.query(getEntryById)

  /**
   * Gets the version of one api
   */
  getApiVersions = this.query(getSubEntries)

  /**
   * Gets the openAPI of one version
   */
  getApiVersionDocs = this.query(downloadObjectArtifacts)

}

export const apiManagementClient = new ApiManagementClient()
