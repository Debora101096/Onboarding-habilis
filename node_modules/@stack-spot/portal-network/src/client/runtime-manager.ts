import { HttpError } from '@oazapfts/runtime'
import { defaults, getAppInfo, getAppsInRealm, getPluginDeployments, getRunByUlid, getRunsOnAllEnvs, getRunsOnEnv, getRunsRunning, getRunTaskPlugins, getRunTasks, runRollbackApp1, runRollbackInfra1 } from '../api/apiRuntime'
import { DefaultAPIError } from '../error/DefaultAPIError'
import { rteDictionary } from '../error/dictionary/rte'
import { StackspotAPIError } from '../error/StackspotAPIError'
import { ReactQueryNetworkClient } from '../network/ReactQueryNetworkClient'
import { getApiAddresses } from '../api-addresses'

class RuntimeManagerClient extends ReactQueryNetworkClient {
  constructor() {
    super(getApiAddresses().apiRuntime.url, defaults)
  }

  protected buildStackSpotError(error: HttpError): StackspotAPIError {
    return new DefaultAPIError(error.data, error.status, rteDictionary, error.headers)
  }

  /**
   * Runs an app rollback
   */
  appRollback = this.mutation(runRollbackApp1)
 
  /**
   * Runs an infra rollback
   */
  infraRollback = this.mutation(runRollbackInfra1)

  /**
   * Internal use only (Only Authorized tokens) - Admin endpoint for getting all runnings run
   */
  adminGetRunsRunning = this.query(getRunsRunning)

  /**
   * Internal use only (Only Authorized tokens) - Admin endpoint for getting all runs off an app or infra on an env
   */
  adminGetRunsOnEnv = this.query(getRunsOnEnv)

  /**
   * Internal use only (Only Authorized tokens) - Admin endpoint for getting all runs off an app or infra on every environment its deployed
   */
  adminGetRunsOnAllEnvs = this.query(getRunsOnAllEnvs)

  /**
   * Internal use only (Only Authorized tokens) - Admin endpoint for getting run data by ulid identifier
   */
  adminGetRunByUlid = this.query(getRunByUlid)

  /**
   * Internal use only (Only Authorized tokens) - Admin endpoint for getting run task data of a run
   */
  adminGetRunTasks = this.query(getRunTasks)

  /**
   * Internal use only (Only Authorized tokens) - Admin endpoint for getting run task plugin data of a run
   */
  adminGetRunTaskPlugins = this.query(getRunTaskPlugins)
  
  /**
   * Internal use only (Only Authorized tokens) - Admin endpoint for getting plugin deployment data of a run
   */
  adminGetPluginDeployments = this.query(getPluginDeployments)
  

  /**
   * Internal use only (Only Authorized tokens) - Admin endpoint for getting the list of apps in a realm
   */
  adminGetAppsInRealm = this.query(getAppsInRealm)
  
  
  /**
   * Internal use only (Only Authorized tokens) - Admin endpoint for getting app or infra information by ulid
   */
  adminGetAppInfo = this.query(getAppInfo)
} 

export const runtimeManagerClient = new RuntimeManagerClient()
